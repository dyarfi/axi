<?php defined('SYSPATH') OR die('No direct access allowed.');class Controller_Backend_PageMenu extends Controller_Backend_BaseAdmin {	protected $_module_name;	protected $_class_name;	protected $_search_keys;	protected $_prefs;	protected $_upload_path;	protected $menu;	protected $menus;	protected $statuses;		public function before () {		parent::before();		$this->_module_name		= 'page';		$this->_class_name		= strtolower(str_replace('Controller_Backend_', '', get_class($this)));		$this->_module_menu		= $this->acl->module_menu;		$this->_search_keys		= array('title'		=> 'Title',										'name'		=> 'Name',										'status'	=> 'Status');		$this->_prefs			= (Lib::config($this->_module_name.'.page_menu_fields') !== NULL) ? Lib::config($this->_module_name.'.page_menu_fields') : array();		$this->_upload_path		= (Lib::config($this->_module_name.'.menu_upload_path') !== NULL) ? Lib::config($this->_module_name.'.menu_upload_path') : array();		$this->_upload_url		= (Lib::config($this->_module_name.'.menu_upload_url') !== NULL) ? Lib::config($this->_module_name.'.menu_upload_url') : array();		$this->menu			= new Model_PageMenu;		$this->file			= new Model_PageMenuFile;		$where_cond			= array('status !='	=> 'deleted');		$this->menus		= $this->menu->find($where_cond);		$this->position		= array(1 => 'Top',									2 => 'Bottom',									3 => 'Top & Bottom');		$this->statuses		= array('publish',										'unpublish');		unset($menu);	}		function action_index () {		$where_cond	= array('status !='	=> 'deleted');		/** Find & Multiple change status **/		if ($_POST) {			$post	= Validation::factory($_POST);			if (isset($post['field']) || isset($post['keyword'])) {				$post->rule('keyword', 'regex', array(':value', '/^[a-z_.\-]++$/iD'));				if ($post->check()) {					$where_cond[$post['field'] . ' LIKE']	= $post['keyword'] . '%';					$filters	= array('f'	=> $post['field'],										'q'	=> $post['keyword']);					$this->session->set($this->_class_name.'_filter', serialize($filters));				} else if (isset($post['find'])) {					$this->session->delete($this->_class_name.'_filter');				}			}			if ($this->session->get($this->_class_name.'_filter') !== FALSE) {				$filters	= unserialize($this->session->get($this->_class_name.'_filter'));				if (in_array($filters['f'], array_keys($this->_search_keys)) && $filters['q'] != '')					$where_cond[$filters['f'] . ' LIKE']	= '%' . $filters['q'] . '%';			}		}		/** Table sorting **/		$params		= Request::$current->param();		$sorts		= array('asc', 'desc');		$sort		= isset($params['id2']) ? $this->id2 : 'order';		$order		= isset($params['id4']) ? $this->id4 : $sorts[0];		$order_by	= array($sort 	=> $order);		$page_index	= isset($_GET['page']) ? $_GET['page'] - 1: 0;		$per_page	= Lib::config('admin.item_per_page');		//$per_page	= 10;		$page_url	= isset($_GET['page']) ? '?page='.$_GET['page'] : '';		$base_url	= ADMIN.$this->_class_name;		$offset		= ($page_index == 0) ? '' : $page_index * $per_page;		$table_headers	= array('title'		=> 'Title',								'status'	=> 'Status',								'added'		=> 'Added',								'modified'	=> 'Modified');		if (!isset($this->_prefs['show_position']) && !$this->_prefs['show_position']) {			unset($table_headers['position']);		}		if (isset($params['sort']) && isset($params['order'])) {			$headers	= array_keys($table_headers);			$sort		= (isset($params['sort']) && in_array(strtolower($params['sort']), $headers)) ? strtolower($params['sort']) : $headers[0];			$order		= (isset($params['order']) && in_array(strtolower($params['order']), $sorts)) ? strtolower($params['order']) : $sorts[0];			$order_by	= array($sort	=> $order);			$base_url	= ADMIN.$this->_class_name.'/index/sort/' . $params['sort'] . '/order/' . $params['order'] . '/page/';		}		/** Execute list query **/		$field		= isset($filters['f']) ? $filters['f'] : '';		$keyword	= isset($filters['q']) ? $filters['q'] : '';		$where_cond	= isset($where_cond) ? $where_cond : '';		$total_rows		= count($this->menu->find($where_cond));		$total_record 	= $total_rows;		$listings	= $this->menu->find($where_cond, $order_by, $per_page, $offset);		/** Initialize pagination **/		$pagination = Pagination::factory(array(				'total_items' 		=> $total_rows,				'items_per_page' 	=> $per_page			 )		);						$total_deleted = count($this->menu->get_deleted());				/** Views **/		$content_vars		= array('listings'		=> $listings,									'parents'		=> $this->menu,									'table_headers'	=> $table_headers,									'statuses'		=> $this->statuses,									'position'		=> $this->position,									'set_order'		=> $this->menu,									'module_name'	=> $this->_module_name,									'class_name'	=> $this->_class_name,									'module_menu'	=> $this->_module_menu,									'search_keys'	=> $this->_search_keys,									'total_record'	=> $total_record,									'total_deleted'	=> $total_deleted,									'field'			=> $field,									'keyword'		=> $keyword,									'order'			=> $order,									'sort'			=> $sort,									'page_url'		=> $page_url,									'page_index'	=> $offset,									'params'		=> $params,									'pagination'	=> $pagination);		$content_vars		= array_merge($content_vars, $this->_prefs);		$content			= View::factory($this->_module_name.'/backend/'.$this->_class_name.'_index');		foreach ($content_vars as $var => $val) {			$content->$var	= $val;		}		$this->template->content		= $content;	}		public function action_add () {		$fields	= array('parent_id'		=> '',						'name'			=> '',						'title'			=> '',						'description'	=> '',						'url'			=> '',						'media'			=> '',												'position'		=> '',						'order'			=> '',						'is_system'		=> '',						'status'		=> '');		if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {			foreach ($this->_prefs['uploads'] as $row_name => $row_params) {				$fields[$row_name]	= '';				if (isset($row_params['caption']) && $row_params['caption'])					$fields[$row_name.'_caption']	= '';			}		}		$errors	= $fields;		if ($_POST) {			$_POST['media'] = !empty($_POST['_media']) ? $_POST['_media'] : $_POST['media'];						if ($_FILES) 				$post	= Validation::factory(array_merge($_POST,$_FILES));			else				$post	= Validation::factory($_POST);			$post->rule('title', 'not_empty');            $post->rule('title', 'min_length', array(':value', 1));            $post->rule('name', 'not_empty');			$post->rule('name', 'min_length', array(':value', 1));			$post->rule('description', 'not_empty');            $post->rule('status', 'not_empty');			$post->rule('order', 'numeric');			$post->rule('name', array($this, '_unique_name'), array(':validation', 'name'));						$post->rule('url', 'Valid::url');						if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['menu_uploads'])) {				foreach ($this->_prefs['uploads'] as $row_name => $row_params) {					if (isset($row_params['optional']) && !$row_params['optional']) {						//$post->rules($row_name, 'Upload::required');						$post->rule($row_name, 'Upload::valid');					}					if (Upload::type($post[$row_name],explode(',',$row_params['file_type'])) !== 1)						continue;					//if (isset($row_params['file_type']))						//$post->rule(substr($post[$row_name]['type'], strpos($post[$row_name]['type'], '/') + 1), 'Upload::type['.$row_params['file_type'].']');					//if (isset($row_params['max_file_size']))						//$post->rule(round($post[$row_name]['size'] / 1024, 2).'KB', 'Upload::size['.$row_params['max_file_size'].']');				}			}			if ($post->check()) {				$fields	= $post->as_array();				if (!empty($fields['parent_id']) && $fields['parent_id'] != 0) {					$parent		= $this->menu->load($fields['parent_id']);					$sub_level	= $parent->sub_level + 1;					unset($parent);				} else {					$sub_level	= 0;				}				$order			= 1;				if (!empty($fields['order']) && $fields['order'] != 0) {					$order = $this->menu->get_order($fields['parent_id']) + 1;				}				$params	= array('parent_id'		=> !empty($fields['parent_id']) ? $fields['parent_id'] : 0,								'name'			=> trim($fields['name']),								'title'			=> trim($fields['title']),								'description'	=> $fields['description'],								'position'		=> (isset($this->_pref['show_position']) && $this->_prefs['show_position']) ? $fields['position'] : '1',								'url'			=> !empty($fields['url']) ? $fields['url'] : '',								'media'			=> !empty($fields['media']) ? $fields['media'] : '',																'sub_level'		=> $sub_level,								'order'			=> !empty($fields['order']) ? $fields['order'] : $this->menu->set_order(@$fields['parent_id'],'','MAX') + 1,								'user_id'		=> (isset($this->acl->user->id)) ? $this->acl->user->id : 0,								'status'		=> $fields['status']);				$id		= $this->menu->add($params);				if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {					$file_names	= '';					foreach ($this->_prefs['uploads'] as $row_name => $row_params) {						// if (!Upload::not_empty($post[$row_name]) || !Upload::type($post[$row_name],explode(',',$row_params['file_type'])) || !Upload::valid($post[$row_name]))							// continue;						// if (Upload::type($post[$row_name],explode(',',$row_params['file_type'])) !== 1)							// continue;						if (!File::exts_by_mime($post[$row_name]['type']))							continue;						$file_hash	= md5(time() + rand(100, 999));						$file_data	= pathinfo($post[$row_name]['name']);						$file_name	= Lib::_upload_to($post[$row_name], $file_hash.'.'.$file_data['extension'], $this->_upload_path, 0755);						$file_data	= pathinfo($file_name);						$file_mime	= $post[$row_name]['type'];						if ($file_name != '' && isset($this->_prefs['uploads'][$row_name]['image_manipulation'])) {							$params			= array('menu_id'	=> $id,													'field_name'	=> $row_name,													'file_name'		=> $file_data['basename'],													'file_type'		=> $file_mime,													'caption'		=> isset($fields[$row_name.'_caption']) ? $fields[$row_name.'_caption'] : '');							$this->file->add($params);						}					}				}				if (isset($fields['add_another'])) {					$this->request->redirect(ADMIN.$this->_class_name.'/add');					return;				}				$this->request->redirect(ADMIN.$this->_class_name.'/view/'.$id);				return;			} else {				$fields		= Arr::overwrite($fields, $post->as_array());				$errors 	= Arr::overwrite($errors, $post->errors('validation'));				$buffers	= $errors;				foreach ($errors as $row_key => $row_val) {					if ($row_val != '') {						$buffers[$row_key]	= Lib::config('admin.error_field_open').ucfirst($row_val).Lib::config('admin.error_field_close');					} else {						$buffers[$row_key]	= $row_val;					}				}				$errors		= $buffers;			}		}		/** Generate Thumbnails **/		//Lib::_auto_image_manipulation($this->_upload_path, $this->file, $this->_prefs);		/** Views **/		$where_cond			= array('status !='		=> 'deleted');		$order_by			= array('order'			=> 'ASC');		$orders				= $this->menu->find($where_cond, $order_by);		$content_vars		= array('action'	=> 'add',									'param'		=> $this->id1,									'errors'	=> $errors,									'fields'	=> $fields,									'orders'	=> $orders,									'menus'	=> $this->menus,									'position'	=> $this->position,									'statuses'	=> $this->statuses,									'module_name' 	=> $this->_module_name,									'class_name'	=> $this->_class_name,									'module_menu'	=> $this->_module_menu);		$content_vars		= array_merge($content_vars, $this->_prefs);		$content			= View::factory($this->_module_name.'/backend/'.$this->_class_name.'_form');		foreach ($content_vars as $var => $val) {			$content->$var	= $val;		}		$this->template->content		= $content;  	}		public function action_view () {		$this->menu->id	= $this->id1;		if (!$this->menu->load()) {			$this->request->redirect(ADMIN.$this->_class_name.'/error/invalid_request');			return;		}		/** Views **/		if ($this->menu->parent_id != 0) {			$parent			= $this->menu->load($this->menu->parent_id);			$parent			= HTML::chars($parent->title, TRUE);		} else {			$parent			= 'This menu is parent';		}//		$order				= '';		if ($this->menu->order != 1) {			$where_cond		= array('parent_id'	=> $this->menu->parent_id,									'order'		=> ($this->menu->order - 1));			$menus		= $this->menu->find($where_cond, '', 1);			$order			= 'After '.strtolower(str_replace('_', ' ', $this->_class_name)).' '.HTML::chars(@$menus[0]->title, TRUE);		} else {			$order			= 'At the beginning';		}		$where_cond			= array('menu_id'	=> $this->id1);		$files				= $this->file->find($where_cond);		$buffers			= array();		foreach ($files as $row) {			$buffers[$row->field_name]	= $row;		}		$files				= $buffers;		unset($buffers);		/** Generate Thumbnails **/		Lib::_auto_image_manipulation($this->_upload_path, $this->file, $this->_prefs);		/** Views **/		$content_vars		= array(									'files'	  	=> $files,									'upload_path' => $this->_upload_path,									'upload_url'  => $this->_upload_url,									'module_menu' => $this->_module_menu,									'menu'	=> $this->menu,									'position'	=> $this->position,									'parent'	=> $parent,									'order'		=> $order,									'module_name'=>$this->_module_name,									'readable_mime'	=> Lib::config($this->_module_name.'.readable_mime'),									'class_name'=>$this->_class_name									);		$content_vars		= array_merge($content_vars, $this->_prefs);		$content			= View::factory($this->_module_name.'/backend/'.$this->_class_name.'_view');		foreach ($content_vars as $var => $val) {			$content->$var	= $val;		}		$this->template->content		= $content;     }		public function action_edit () {		$id = $this->id1;		$this->menu->id	= $id;							if (!$this->menu->load()) {			$this->request->redirect(ADMIN.$this->_class_name.'/error/invalid_request');			return;		}						$fields	= array('parent_id'		=> '',						'name'			=> '',						'title'			=> '',						'description'	=> '',						'url'			=> '',						'media'			=> '',						'position'		=> '',						'order'			=> '',						'is_system'		=> '',						'status'		=> '');		if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {			foreach ($this->_prefs['uploads'] as $row_name => $row_params) {				$fields[$row_name]	= '';			}		}		$errors	= $fields;						if ($_POST) {			@$_POST['media'] = !empty($_POST['_media']) ? $_POST['_media'] : $_POST['media'];			@$_POST['media'] = !empty($_POST['media_clear']) ? '' : $_POST['media'];			if ($_FILES)				$post	= new Validation(array_merge($_POST, $_FILES));			else				$post	= new Validation($_POST);									$post->rule('title', 'not_empty');            $post->rule('title', 'min_length', array(':value', 1));            $post->rule('name', 'not_empty');			$post->rule('name', 'min_length', array(':value', 1));			$post->rule('description', 'not_empty');            $post->rule('status', 'not_empty');			//$post->rule('name', array($this, '_unique_name'), array(':validation', 'name'));			$post->rule('url', 'Valid::url');						if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {				foreach ($this->_prefs['uploads'] as $row_name => $row_params) {					// if (isset($row_params['file_type']))						// $post->add_rules($row_name, 'upload::type['.$row_params['file_type'].']');					// if (isset($row_params['max_file_size']))						// $post->add_rules($row_name, 'upload::size['.$row_params['max_file_size'].']');					if (Upload::type($post[$row_name],explode(',',$row_params['file_type'])) !== 1)						continue;					}			}			if ($post->check()) {												$fields	= $post->as_array();				if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {					$where_cond			= array('menu_id'	=> $this->menu->id);					$files				= $this->file->find($where_cond);					$buffers			= array();					foreach ($files as $row) {						$buffers[$row->field_name]	= $row;					}					$files				= $buffers;					foreach ($this->_prefs['uploads'] as $row_name => $row_params) {						if (isset($fields['delete_'.$row_name]) && $fields['delete_'.$row_name] == 1 && isset($files[$row_name])) {							$this->file->id	= $files[$row_name]->id;							$this->file->load();							$this->file->delete();						}						//if (!isset($_FILES[$row_name]) || (isset($_FILES[$row_name]) && !upload::required($_FILES[$row_name]) || !upload::valid($_FILES[$row_name])))							//continue;						if (!File::exts_by_mime($post[$row_name]['type']))							continue;						$file_hash	= md5(time() + rand(100, 999));						$file_data	= pathinfo($post[$row_name]['name']);						$file_name	= Lib::_upload_to($post[$row_name], $file_hash.'.'.$file_data['extension'], $this->_upload_path, 0755);						$file_data	= pathinfo($file_name);						$file_mime	= $post[$row_name]['type'];						if (!isset($files[$row_name])) {							$params			= array('menu_id'	=> $id,													'field_name'	=> $row_name,													'file_name'		=> $file_data['basename'],													'file_type'		=> $file_mime,													'caption'		=> isset($fields[$row_name.'_caption']) ? $fields[$row_name.'_caption'] : '');							$this->file->add($params);						} else {							$this->file->id	= $files[$row_name]->id;							$this->file->load();							$params			= array('menu_id'		=> $id,													'field_name'	=> $row_name,													'file_name'		=> $file_data['basename'],													'file_type'		=> $file_mime,													'caption'		=> isset($fields[$row_name.'_caption']) ? $fields[$row_name.'_caption'] : '');							foreach ($params as $var => $val) {								$this->file->$var	= $val;							}							$this->file->update();						}					}				}										$params	= array(								'name'		  => trim($fields['name']),								'title'		  => trim($fields['title']),								'description' => $fields['description'],								'url'		  => !empty($fields['url']) ? $fields['url'] : '',								'media'		  => !empty($fields['media']) ? $fields['media'] : '',								'position'	  => $this->_prefs['show_position'] ? $fields['position'] : '',								'status'	  => $fields['status']);				foreach ($params as $var => $val) {					$this->menu->$var	= $val;				}				$this->menu->update();				$this->request->redirect(ADMIN.$this->_class_name.'/view/'.$id);				return;			} else {				$fields		= Arr::overwrite($fields, $post->as_array());				$errors 	= Arr::overwrite($errors, $post->errors('validation'));				$buffers	= $errors;				foreach ($errors as $row_key => $row_val) {					if ($row_val != '')						$buffers[$row_key]	= Lib::config('admin.error_field_open').ucfirst($row_val).Lib::config('admin.error_field_close');					else						$buffers[$row_key]	= $row_val;				}				$errors		= $buffers;			}		} else {			$fields	= array('parent_id'	=> $this->menu->parent_id,							'name'		=> $this->menu->name,							'title'		=> $this->menu->title,							'description'	=> $this->menu->description,							'url'		=> $this->menu->url,							'media'	=> $this->menu->media,							'position'	=> $this->menu->position,							'order'		=> $this->menu->order,							'is_system'	=> $this->menu->is_system,							'status'	=> $this->menu->status);					}		$where_cond			= array('menu_id'	=> $this->menu->id);		$files				= $this->file->find($where_cond);		$buffers			= array();		foreach ($files as $row) {			$buffers[$row->field_name]	= $row;		}		$files				= $buffers;		unset($buffers);		if (isset($this->_prefs['show_menu_upload']) && $this->_prefs['show_menu_upload'] && isset($this->_prefs['uploads'])) {			foreach ($this->_prefs['uploads'] as $row_name => $row_params) {				$fields[$row_name]	= '';				if (isset($row_params['caption']) && $row_params['caption'])					$fields[$row_name.'_caption']	= (isset($files[$row_name])) ? $files[$row_name]->caption : '';			}		}		/** Generate Thumbnails **/		Lib::_auto_image_manipulation($this->_upload_path, $this->file, $this->_prefs);		/** Views **/		$where_cond			= array('parent_id'		=> $this->menu->parent_id);		$orders				= $this->menu->find($where_cond);		$content_vars		= array('action'	=> 'edit',									'param'		=> $this->id1,									'errors'	=> $errors,									'fields'	=> $fields,									'menu'		=> $this->menu,									'menus'		=> $this->menus,									'files'			=> $files,									'upload_path' 	=> $this->_upload_path,									'upload_url'  	=> $this->_upload_url,									'orders'		=> $orders,									'position'		=> $this->position,									'statuses'		=> $this->statuses,									'module_name' 	=> $this->_module_name,									'class_name'	=> $this->_class_name,									'module_menu'	=> $this->_module_menu,									'readable_mime'	=> Lib::config($this->_module_name.'.readable_mime'),									);		$content_vars		= array_merge($content_vars, $this->_prefs);		$content			= View::factory($this->_module_name.'/backend/'.$this->_class_name.'_form');		foreach ($content_vars as $var => $val) {			$content->$var	= $val;		}		$this->template->content		= $content;	}		public function action_delete () {		$this->menu->id	= $this->id1;		if (!$this->menu->load()) {			$this->request->redirect(ADMIN.'error/invalid_request');			return;		}		$this->menu->status	= 'deleted';		if($this->menu->update())			echo 1;		else			echo 0;		exit;//		$redirect_url	= ($this->acl->previous_url != '') ? $this->acl->previous_url : ADMIN.$this->_class_name.'/index';////		$this->request->redirect($redirect_url);	}		/*** Function Access ***/	// Action for update item status	public function action_change() {		if ($this->request->post('check') !='') {			$rows	= $this->request->post('check');			foreach ($rows as $row) {				$this->menu->id	= $row;				if (!$this->menu->load())					continue;				$this->menu->status	= $this->request->post('select_action');				$this->menu->update();				// Change child status				$children = $this->menu->find(array('parent_id'=>$this->menu->id));				if (!empty($children)) {					foreach ($children as $child) {						$child->status = $this->request->post('select_action');						$child->update();					}				}			}			$redirect_url	= (strstr($this->acl->previous_url,ADMIN)) ? $this->acl->previous_url : ADMIN.$this->_class_name.'/index';			//$this->request->redirect($redirect_url);			$this->request->redirect(ADMIN.$this->_class_name);		} else {			$this->request->redirect(ADMIN.$this->_class_name);		}	}		public function action_aorder() {		echo $id2;		$files		= $this->id1;		$where_cond	= array('file_name'	=> $files);		$files		= $this->menu->find($where_cond);		foreach ($files as $row) {			Lib::_download(Lib::config($this->_module_name.'.upload_url').$row->file_name);		}	}		public function action_download() {		$files		= $this->id1;		$where_cond	= array('file_name'	=> $files);		$files		= $this->file->find($where_cond);		foreach ($files as $row) {			Lib::_download_file_force('',$this->_upload_url.$row->file_name);		}	}		// Action for ordering item list	public function action_order() {		if (empty($this->id2) && empty($this->id3))			continue;					if ($this->id1 == 'up' && $this->id2 && $this->id3) {						$where_cond = ($this->id4) ? array('order'=>$this->id3 + 1, 'parent_id'=>$this->id4) : array('order'=>$this->id3 + 1);			$order_by   = array('order'=>'asc');						$order_default = $this->menu->find($where_cond,$order_by,1);						if (!empty($order_default)) {				foreach ($order_default as $default) {					$default->order  = ($default->order != $this->menu->set_order($default->parent_id,'','MIN')) ? $default->order - 1 : 0;					$default->update();				}			}			$this->menu->id = $this->id2;			$this->menu->load();			$this->menu->order = $this->id3 + 1;			$this->menu->update();		} 		if ($this->id1 == 'down' && $this->id2 && $this->id3) {						$where_cond = ($this->id4) ? array('order'=>$this->id3 - 1, 'parent_id'=>$this->id4) : array('order'=>$this->id3 - 1);			$order_by	= array('order'=>'asc');						$order_default = $this->menu->find($where_cond,$order_by,1);						if (!empty($order_default)) {				foreach ($order_default as $default) {					$default->order  = ($default->order != $this->menu->set_order($default->parent_id,'','MAX')) ? $default->order + 1 : 1;					$default->update();				}			}			$this->menu->id = $this->id2;			$this->menu->load();			$this->menu->order = $this->id3 - 1;			$this->menu->update();		}				if ($this->request->is_ajax()) {			echo $this->id2;			exit();		}		$this->request->redirect(ADMIN.$this->_class_name);			}			/** CALLBACKS **/	public function _file_type (Validation $array, $field) {		if (!isset($array[$field]))			return;		$valid = Upload::type($array[$field], explode(',',array('gif','jpg','png')));		if ($valid)			return $array->error($field, 'file_type');	}		public function _unique_name (Validation $array, $field) {		if (!isset($array[$field]))			return;		$name = Model_PageMenu::instance()->find_count(array('name' => $array[$field]));		if ($name)			return $array->error($field, 'unique_name');	}		public function _valid_parent_id (Validation $array, $field) {		if ($array[$field] == 0)			return TRUE;		$where_cond		= array('id'	=> $array[$field]);		$parent_exists	= ($this->menu->find_count($where_cond) != 0);		if (!$parent_exists)			$array->error($field, 'invalid_parent_id');	}		public function _valid_status (Validation $array, $field) {		if (!in_array($array[$field], $this->statuses))			$array->error($field, 'invalid_status');	}		public function _valid_search_key (Validation $array, $field) {		if (!isset($this->_search_keys)) {			$array->error($field, 'invalid_search_key');			return;		}		$keys			= array_keys($this->_search_keys);		if (!in_array($array[$field], $keys))			$array->error($field, 'invalid_search_key');	}}